<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Artwork - Admin Panel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
</head>
<body>
    <main class="container mt-4">
        <h2>Add New Artwork</h2>
        <form method="POST" action="/add_artwork" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <label for="sku">SKU:</label>
            <input type="text" name="sku" id="sku" required>

            <label for="name">Name:</label>
            <input type="text" name="name" id="name" required>

            <label for="category">Category:</label>
            <select name="category" id="category" required>
                <option value="">-- Select --</option>
                {% for cat in categories %}
                <option value="{{ cat.name }}">{{ cat.name }}</option>
                {% endfor %}
            </select>

            <label for="original_price">Price (â‚¹):</label>
            <input type="number" name="original_price" step="0.01" required>

            <label for="stock">Stock:</label>
            <input type="number" name="stock" required>

            <label for="gst_percentage">GST %:</label>
            <input type="number" name="gst_percentage" step="0.01">

            <label for="description">Description:</label>
            <textarea name="description" rows="3"></textarea>

            <label>Upload Images:</label>
            <input type="file" name="images" accept="image/*" multiple>

            <!-- âœ… Basic Option Pricing -->
            <fieldset>
                <legend>Option Pricing (Optional)</legend>
                <label>Frame - Wooden:</label><input type="number" name="frame_wooden" step="0.01" value="0.00">
                <label>Frame - Metal:</label><input type="number" name="frame_metal" step="0.01" value="0.00">
                <label>Frame - PVC:</label><input type="number" name="frame_pvc" step="0.01" value="0.00">
                <label>Glass:</label><input type="number" name="glass_price" step="0.01" value="0.00">
                <label>Size - A4:</label><input type="number" name="size_a4" step="0.01" value="0.00">
                <label>Size - A5:</label><input type="number" name="size_a5" step="0.01" value="0.00">
                <label>Size - Letter:</label><input type="number" name="size_letter" step="0.01" value="0.00">
                <label>Size - Legal:</label><input type="number" name="size_legal" step="0.01" value="0.00">
            </fieldset>

            <!-- âœ… Enable Dynamic Custom Options -->
            <div class="form-check mt-3">
                <input class="form-check-input" type="checkbox" id="enable_custom_options" name="has_custom_options">
                <label class="form-check-label" for="enable_custom_options">
                    Enable Custom Options (e.g. Material, Height, Weight)
                </label>
            </div>

            <!-- âœ… Dynamic Option Input Section -->
            <div id="custom_options_section" style="display:none; border:1px solid #ddd; padding:1rem; border-radius:6px;">
                <div id="option-groups-container"></div>
                <button type="button" class="btn btn-sm btn-secondary mt-2" onclick="addOptionGroup()">+ Add Option Group</button>
            </div>

            <input type="hidden" name="custom_options_json" id="custom_options_json">

            <button type="submit" class="btn btn-primary mt-4">Add Artwork</button>
        </form>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const enableCustomOptions = document.getElementById('enable_custom_options');
        const section = document.getElementById('custom_options_section');
        const jsonInput = document.getElementById('custom_options_json');
        const container = document.getElementById('option-groups-container');

        enableCustomOptions.addEventListener('change', function () {
            section.style.display = this.checked ? 'block' : 'none';
        });

        window.addOptionGroup = function () {
            const groupDiv = document.createElement('div');
            groupDiv.classList.add('mb-3');
            groupDiv.innerHTML = `
                <label>Option Group Name:</label>
                <input type="text" class="form-control option-group-name mb-2" placeholder="e.g. Material">
                <div class="option-values"></div>
                <button type="button" class="btn btn-sm btn-outline-primary mb-2" onclick="addOptionValue(this)">+ Add Value</button>
            `;
            container.appendChild(groupDiv);
        }

        window.addOptionValue = function (btn) {
            const valueInput = document.createElement('input');
            valueInput.type = 'text';
            valueInput.className = 'form-control form-control-sm mb-1 option-value';
            valueInput.placeholder = 'e.g. Brass, Bronze';
            btn.previousElementSibling.appendChild(valueInput);
        }

        // ðŸ§  Before submit, collect custom options into JSON
        document.querySelector('form').addEventListener('submit', function () {
            if (!enableCustomOptions.checked) return;
            const groups = container.querySelectorAll('div');
            const result = {};
            groups.forEach(group => {
                const name = group.querySelector('.option-group-name')?.value?.trim();
                const values = Array.from(group.querySelectorAll('.option-value'))
                                    .map(v => v.value.trim()).filter(Boolean);
                if (name && values.length > 0) {
                    result[name] = values;
                }
            });
            jsonInput.value = JSON.stringify(result);
        });
    });
    </script>
</body>
</html>