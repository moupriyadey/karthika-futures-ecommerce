{% extends '_base.html' %}

{% block title %}Sign Up - Karthika Futures{% endblock %}

{% block content %}
<div class="container main-content-area py-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <h3 class="text-center mb-4">Create Your Account</h3>

      <form method="POST" action="{{ url_for('signup') }}" class="p-4 border rounded shadow-sm bg-white">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        {% if next_url %}<input type="hidden" name="next" value="{{ next_url }}">{% endif %}

        <div class="mb-3">
          <label for="name" class="form-label">Full Name</label>
          <input type="text" class="form-control" id="name" name="name" value="{{ form_data.name or '' }}" placeholder="Enter your full name" required>
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">Email address</label>
          <input type="email" class="form-control" id="email" name="email" value="{{ form_data.email or '' }}" placeholder="e.g., your.email@example.com" required>
        </div>

        <div class="mb-3">
          <label for="password" class="form-label">Password</label>
          <div class="input-group">
            <input type="password" class="form-control" id="password" name="password" placeholder="Min 6 characters" minlength="6" required>
            <button class="btn btn-outline-secondary toggle-password" type="button" data-target="password">
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>

        <div class="mb-3">
          <label for="confirm_password" class="form-label">Confirm Password</label>
          <div class="input-group">
            <input type="password" class="form-control" id="confirm_password" name="confirm_password" placeholder="Re-enter your password" minlength="6" required>
            <button class="btn btn-outline-secondary toggle-password" type="button" data-target="confirm_password">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          <div id="passwordMatchFeedback" class="invalid-feedback" style="display: none;">
            Passwords do not match.
          </div>
        </div>

        <div class="mb-3">
          <label for="phone" class="form-label">Mobile Number</label>
          <input type="tel" class="form-control" id="phone" name="phone" value="{{ form_data.phone or '' }}" placeholder="e.g., 9876543210" pattern="[0-9]{10}" maxlength="10" required>
          <small class="form-text text-muted">Please enter a 10-digit mobile number.</small>
        </div>

        <div class="mb-3">
          <label for="address" class="form-label">Full Address</label>
          <textarea class="form-control" id="address" name="address" rows="3" placeholder="House No, Street, Locality, City, State" required>{{ form_data.address or '' }}</textarea>
        </div>

        <div class="mb-3">
          <label for="pincode" class="form-label">Pincode</label>
          <input type="text" class="form-control" id="pincode" name="pincode" value="{{ form_data.pincode or '' }}" placeholder="e.g., 560001" pattern="[0-9]{6}" maxlength="6" required>
          <small class="form-text text-muted">Please enter a 6-digit pincode.</small>
        </div>

        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-primary">Sign Up</button>
        </div>
      </form>

      <p class="text-center mt-3">
        Already have an account? <a href="{{ url_for('user_login') }}">Login here</a>
      </p>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const passwordField = document.getElementById('password');
    const confirmPasswordField = document.getElementById('confirm_password');
    const passwordMatchFeedback = document.getElementById('passwordMatchFeedback');
    const signupForm = document.querySelector('form');

    // Function to toggle password visibility
    document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', () => {
            const targetId = button.dataset.target;
            const targetInput = document.getElementById(targetId);
            const icon = button.querySelector('i');

            if (targetInput.type === 'password') {
                targetInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                targetInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
    });

    // Function to check if passwords match
    function checkPasswordsMatch() {
        if (passwordField.value === confirmPasswordField.value) {
            confirmPasswordField.classList.remove('is-invalid');
            passwordMatchFeedback.style.display = 'none';
            return true;
        } else {
            confirmPasswordField.classList.add('is-invalid');
            passwordMatchFeedback.style.display = 'block';
            return false;
        }
    }

    // Add event listeners for password matching
    passwordField.addEventListener('input', checkPasswordsMatch);
    confirmPasswordField.addEventListener('input', checkPasswordsMatch);

    // Prevent form submission if passwords don't match
    signupForm.addEventListener('submit', (event) => {
        if (!checkPasswordsMatch()) {
            event.preventDefault(); // Stop form submission
            showCustomAlert('Passwords do not match. Please correct them.', 'danger');
        }
    });
});
</script>
{% endblock %}
