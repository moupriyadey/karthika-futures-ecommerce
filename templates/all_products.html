{% extends '_base.html' %}

{% block title %}All Artworks - Karthika Futures{% endblock %}

{% block content %}
<div class="container mx-auto p-4 md:p-8 main-content-area">
  <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-8">Our Divine Collection</h1>

  <div class="mb-8 flex justify-center">
    <form action="{{ url_for('all_products') }}" method="GET" class="w-full max-w-lg flex">
      <input type="search" name="search" placeholder="Search artworks by name, SKU or description..."
             class="form-control flex-grow rounded-l-lg border-r-0 focus:ring-primary focus:border-primary"
             value="{{ search_query }}">
      <button type="submit" class="btn btn-primary rounded-r-lg px-6 py-2.5">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
             xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </button>
    </form>
  </div>

  {% if categorized_artworks %}
    {% for category_name, artworks in categorized_artworks.items() %}
      <section class="py-8 mb-8 bg-white rounded-lg shadow-md">
        <div class="container mx-auto">
          <h2 class="text-3xl font-bold text-gray-800 mb-6 px-4">{{ category_name }}</h2>
          <div class="relative">
            <div id="category-carousel-{{ category_name | slugify }}" class="flex overflow-x-auto snap-x snap-mandatory pb-4 scrollbar-hide">
              {% for artwork in artworks %}
              <div class="flex-shrink-0 w-80 snap-center mx-3 product-card bg-white rounded-lg shadow-lg overflow-hidden transform transition-transform duration-300 hover:scale-105 hover:shadow-xl">
                <a href="{{ url_for('product_detail', sku=artwork.sku) }}">
                  <div class="aspect-[4/5] bg-white flex items-center justify-center overflow-hidden rounded-lg shadow-sm hover:shadow-md transition duration-300 group">
                    <img 
                      src="{{ url_for('static', filename=artwork.get_images_list()[0] if artwork.get_images_list() else 'images/placeholder.png') }}"
                      alt="{{ artwork.name }}"
                      class="object-contain max-h-full max-w-full transition-transform duration-300 group-hover:scale-105 cursor-pointer"
                      title="Click to view larger"
                      onclick="openFullImage('{{ url_for('static', filename=artwork.get_images_list()[0] if artwork.get_images_list() else 'images/placeholder.png') }}')">
                  </div>
                </a>
                <div class="p-4">
                  <h3 class="text-xl font-semibold text-gray-900 mb-2 truncate">{{ artwork.name }}</h3>
                  <p class="text-gray-600 text-sm mb-3">{{ artwork.description[:100] }}{% if artwork.description|length > 100 %}...{% endif %}</p>
                  <div class="flex items-baseline justify-between mb-4">
                    <span class="text-2xl font-bold text-primary final-price">{{ artwork.selling_price_incl_gst | currency }}</span>
                  </div>
                  <div class="flex items-center mb-3">
                    <div class="text-yellow-500">
                      <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                    </div>
                    <span class="text-sm text-gray-600 ml-2">(4.5/5)</span>
                  </div>
                  {% if artwork.shipping_charge == 0 %}
                    <p class="text-green-600 font-semibold text-sm mb-3"><i class="fas fa-truck mr-1"></i> Free Delivery</p>
                  {% else %}
                    <p class="text-gray-500 text-sm mb-3"><i class="fas fa-truck mr-1"></i> Shipping: {{ artwork.shipping_charge | currency }}</p>
                  {% endif %}
                  <div class="flex justify-center">
                    {% if artwork.stock > 0 %}
  <a href="{{ url_for('product_detail', sku=artwork.sku) }}" class="btn btn-primary px-6 py-2">View Details</a>
{% else %}
  <button class="btn btn-secondary px-6 py-2 opacity-60 cursor-not-allowed" disabled>Out of Stock</button>
{% endif %}

                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
            <button class="absolute left-0 top-1/2 -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100 z-30 opacity-75 hover:opacity-100 transition-opacity" onclick="scrollCarousel('category-carousel-{{ category_name | slugify }}', -1)">
              <i class="fas fa-chevron-left text-gray-700"></i>
            </button>
            <button class="absolute right-0 top-1/2 -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100 z-30 opacity-75 hover:opacity-100 transition-opacity" onclick="scrollCarousel('category-carousel-{{ category_name | slugify }}', 1)">
              <i class="fas fa-chevron-right text-gray-700"></i>
            </button>
          </div>
        </div>
      </section>
    {% endfor %}
  {% else %}
    <div class="text-center py-12 bg-white rounded-lg shadow-md">
      <p class="text-xl text-gray-600 mb-4">No artworks found matching your search criteria.</p>
      <a href="{{ url_for('all_products') }}" class="btn btn-primary">Browse All Artworks</a>
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<!-- Fullscreen Preview Modal -->
<div id="fullImageModal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden justify-center items-center">
  <div class="relative max-w-[90vw] max-h-[90vh]">
    <img id="fullImagePreview" class="max-w-full max-h-full object-contain rounded-lg" src="" alt="">
    <div class="absolute inset-0 pointer-events-none watermark-grid"></div>
    <button onclick="closeFullImage()" class="absolute top-2 right-2 bg-white text-black rounded-full p-1 px-3 font-bold">âœ•</button>
  </div>
</div>

<style>
  .watermark-grid {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Ctext x='0' y='20' font-size='20' fill='rgba(255,255,255,0.2)' font-family='Arial'%3EKarthikafutures%3C/text%3E%3C/svg%3E");
    background-size: 140px 140px;
    background-repeat: repeat;
    opacity: 1;
  }
</style>

<script>
  function openFullImage(src) {
    document.getElementById('fullImagePreview').src = src;
    document.getElementById('fullImageModal').classList.remove('hidden');
    document.getElementById('fullImageModal').classList.add('flex');
  }

  function closeFullImage() {
    document.getElementById('fullImageModal').classList.remove('flex');
    document.getElementById('fullImageModal').classList.add('hidden');
    document.getElementById('fullImagePreview').src = '';
  }
</script>

<script>
  function scrollCarousel(carouselId, direction) {
    const carousel = document.getElementById(carouselId);
    if (carousel) {
      const scrollAmount = carousel.offsetWidth / 2;
      carousel.scrollBy({
        left: direction * scrollAmount,
        behavior: 'smooth'
      });
    }
  }
</script>

<style>
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
</style>
{% endblock %}
