{% extends '_base.html' %}

{% block title %}All Artworks - Karthika Futures{% endblock %}

{% block content %}
<div class="container main-content-area position-relative">
    <h2 class="text-center mb-4">Explore All Artworks</h2>

    {% if artworks %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for artwork in artworks %}
        <div class="col">
            <div class="card artwork-card">
                {% if artwork.images and artwork.images[0] %}
                <img src="{{ url_for('static', filename=artwork.images[0]) }}" class="card-img-top clickable-image" alt="{{ artwork.name }}">
                {% else %}
                <img src="https://placehold.co/400x200/cccccc/333333?text=No+Image" class="card-img-top clickable-image" alt="No Image">
                {% endif %}
                <div class="card-body">
                    <h5 class="card-title">{{ artwork.name }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ artwork.category }}</h6>
                    <p class="card-text">â‚¹{{ artwork.original_price | int }}</p>
                    <div class="btn-group">
                        <a href="{{ url_for('product_detail', sku=artwork.sku) }}" class="btn btn-primary">View Details</a>
                        {% if artwork.stock > 0 %}
                        <button class="btn btn-success add-to-cart-btn"
                                data-sku="{{ artwork.sku }}"
                                data-name="{{ artwork.name }}"
                                data-image="{{ url_for('static', filename=artwork.images[0]) if artwork.images else 'https://placehold.co/240x240/cccccc/333333?text=No+Image' }}"
                                data-original-price="{{ artwork.original_price }}"
                                data-size="Original"
                                data-frame="None"
                                data-glass="None"
                                data-size-price="0"
                                data-frame-price="0"
                                data-glass-price="0">
                            Add to Cart
                        </button>
                        {% else %}
                        <button class="btn btn-secondary" disabled>Out of Stock</button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info text-center" role="alert">
        No artworks are available yet. Please check back later!
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Add to Cart button functionality
        document.querySelectorAll('.add-to-cart-btn').forEach(button => {
            button.addEventListener('click', function() {
                const sku = this.dataset.sku;
                const name = this.dataset.name;
                const image = this.dataset.image;
                const originalPrice = parseFloat(this.dataset.originalPrice);
                const options = {
                    size: this.dataset.size,
                    frame: this.dataset.frame,
                    glass: this.dataset.glass,
                    sizePrice: parseFloat(this.dataset.sizePrice || 0),
                    framePrice: parseFloat(this.dataset.framePrice || 0),
                    glassPrice: parseFloat(this.dataset.glassPrice || 0)
                };
                // Ensure addToCart is called, which should exist globally from _base.html
                if (typeof addToCart === 'function') {
                    addToCart(sku, name, image, originalPrice, options);
                } else {
                    console.error("addToCart function not found. Is _base.html loaded correctly?");
                }
            });
        });
    });
</script>
{% endblock %}
