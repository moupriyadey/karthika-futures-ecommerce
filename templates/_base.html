<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Karthika Futures{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <meta name="csrf-token" content="{{ csrf_token() }}">
    
{# ... (previous content of _base.html) ... #}

<script>
function getEstimatedDeliveryDate(pin) {
    const metro = ['110', '400', '560', '600', '700', '500'];
    const tier2 = ['302', '395', '411', '641', '751'];
    const prefix = pin.substring(0, 3);
    let days = 7;

    if (metro.includes(prefix)) days = 3;
    else if (tier2.includes(prefix)) days = 5;

    const today = new Date();
    today.setDate(today.getDate() + days);

    const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
    return today.toLocaleDateString('en-IN', options);
}

function checkEDD(pinInputId, resultId) {
    const pin = document.getElementById(pinInputId).value;
    const display = document.getElementById(resultId);
    if (!/^\d{6}$/.test(pin)) {
        display.innerText = "‚ùå Enter valid 6-digit Pincode.";
        display.classList.add("text-red-600");
        return;
    }

    const edd = getEstimatedDeliveryDate(pin);
    display.innerText = "üì¶ Expected delivery by: " + edd;
    display.classList.remove("text-red-600");
    display.classList.add("text-green-600");
}
</script>


<style>
    /* Ensure consistent box-sizing for all elements */
    *, *::before, *::after {
        box-sizing: border-box;
    }

    /* Ensure smooth scrolling and touch action for elements with overflow-x-scroll */
    /* This rule is crucial and uses !important to override potential conflicts */
    .overflow-x-scroll {
        scroll-behavior: smooth !important; /* Force smooth scrolling */
        overflow-x: scroll !important; /* Force scroll behavior */
        -webkit-overflow-scrolling: touch; /* Enable momentum scrolling on iOS */
        touch-action: pan-x pan-y; /* Allow horizontal panning for touch events */
    }

    /* Your existing styles in _base.html */
    /* ... */
</style>

{# ... (rest of _base.html) ... #}

    <style>

           /* Ensure smooth scrolling for elements with overflow-x-scroll */
    .overflow-x-scroll {
        scroll-behavior: smooth !important; /* Force smooth scrolling */
    }

        /* Custom styles for the theme */
        :root {
            --primary-color: #FF8C00; /* Saffron */
            --secondary-color: #2E8B57; /* Bright Green */
            --accent-color: #FFBF00; /* Golden Saffron */
            --text-color: #333333;
            --light-bg: #FAF9F6;
            --dark-bg: #1a1a1a;
            --dark-text: #e0e0e0;

            /* New Navbar Colors - Hindu devotional theme */
            --navbar-bg-start: #4A0E4E; /* Deep Plum */
            --navbar-bg-end: #7B1FA2;   /* Amethyst */
            --navbar-text-color: #F8F8F8; /* Near white */
            --navbar-hover-color: #FFD700; /* Gold */
            --navbar-border-color: #FFBF00; /* Golden Saffron */
        }

        /* General Body and Typography */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Prevent horizontal scroll */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Main Content Area Padding */
        .main-content-area {
            padding-top: 5rem; /* Adjust based on fixed navbar height */
            flex-grow: 1;
        }

        /* Custom Alert Styling (from main.js) */
        .custom-alert {
            position: fixed;
            top: 90px; /* Custom Alert height form navbar  */
            right: 20px;
            z-index: 9999;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideInRight 0.5s forwards, fadeOut 0.5s 4.5s forwards;
            min-width: 250px;
        }

        .custom-alert-message {
            margin-right: 15px;
            font-weight: 500;
        }

        .custom-alert.alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid;
            border-image: linear-gradient(to right, #28a745, #218838) 1;
        }

        .custom-alert.alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid;
            border-image: linear-gradient(to right, #dc3545, #c82333) 1;
        }

        .custom-alert.alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 2px solid;
            border-image: linear-gradient(to right, #17a2b8, #138496) 1;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        /* Navbar Styling */
        .navbar {
            background: linear-gradient(to right, var(--navbar-bg-start), var(--navbar-bg-end));
            border-bottom: 2px solid var(--navbar-border-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25); /* Stronger shadow for depth */
            transition: top 0.4s ease-in-out, background 0.3s ease; /* Added top for floating effect */
            padding-top: 0.5rem; /* Compact padding for ~1.5cm height */
            padding-bottom: 0.5rem; /* Compact padding for ~1.5cm height */
        }

        .navbar-brand {
            color: var(--navbar-text-color) !important;
            font-size: 1.5rem; /* Adjusted: Smaller brand font size */
            font-weight: 800; /* Bolder */
            letter-spacing: 0.05em; /* Slight letter spacing */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.4); /* More pronounced shadow */
            transition: color 0.3s ease;
        }

        .navbar-brand:hover {
            color: var(--navbar-hover-color) !important; /* Gold on hover */
        }
        
        .navbar-nav .nav-link {
            color: var(--navbar-text-color) !important;
            font-weight: 600; /* Slightly bolder links */
            font-size: 0.95rem; /* Adjusted: Slightly smaller nav links */
            transition: color 0.3s ease, transform 0.2s ease, text-shadow 0.3s ease;
            padding: 0.4rem 0.8rem; /* Further compact padding for nav links */
            position: relative; /* For underline effect */
            /* Embossed text effect */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3), -1px -1px 2px rgba(255,255,255,0.1);
        }

        .navbar-nav .nav-link:hover {
            color: var(--navbar-hover-color) !important;
            transform: translateY(-2px);
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.6); /* Glowing effect on hover */
        }

        /* Underline effect on hover */
        .navbar-nav .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--navbar-hover-color);
            transition: width 0.3s ease-out;
        }

        .navbar-nav .nav-link:hover::after {
            width: 80%;
        }

        .navbar-nav .nav-item .btn-primary {
            background-color: var(--primary-color) !important; /* Saffron for buttons */
            border-color: var(--primary-color) !important;
            color: white !important;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            padding: 0.4rem 0.8rem; /* Compact button padding */
            font-weight: 600;
        }

        .navbar-nav .nav-item .btn-primary:hover {
            background-color: var(--accent-color) !important; /* Golden Saffron on hover */
            border-color: var(--accent-color) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .navbar-nav .dropdown-menu {
            background-color: #FAF9F6; /* Off-white dropdown background */
            border: 1px solid rgba(0, 0, 0, 0.15);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem; /* More rounded dropdown */
        }

        .navbar-nav .dropdown-item {
            color: var(--text-color);
            padding: 0.75rem 1.25rem;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .navbar-nav .dropdown-item:hover {
            background-color: var(--primary-color); /* Saffron on hover */
            color: white;
        }

        /* Cart Badge */
        #cart-count { 
            background-color: #FF4500; /* Orange-red for attention */
            font-size: 0.75em;
            padding: 0.3em 0.6em;
            border-radius: 50%;
            position: absolute; 
            top: 0px; 
            right: 0px; 
            transform: translate(50%, -50%); 
            display: none; 
            color: white;
            font-weight: bold;
            min-width: 20px; 
            text-align: center;
        }
        .nav-link.cart-icon-container {
            position: relative; 
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Search input styling */
        .navbar .form-control {
            border-radius: 9999px; /* Pill shape */
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--navbar-text-color);
            padding-left: 1.5rem;
            padding-right: 1.5rem;
            transition: all 0.3s ease;
            height: auto; /* Let padding define height */
            flex-grow: 1; /* Allow it to shrink if needed but still look good */
            max-width: 250px; /* Limit width on larger screens */
        }

        .navbar .form-control::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .navbar .form-control:focus {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: var(--navbar-hover-color);
            box-shadow: 0 0 0 0.25rem rgba(255, 215, 0, 0.25);
        }

        .navbar .btn-outline-light {
            border-color: var(--navbar-text-color);
            color: var(--navbar-text-color);
            border-radius: 9999px; /* Pill shape */
            transition: all 0.3s ease;
            padding: 0.4rem 1rem; /* Adjusted for better button size */
            height: auto; /* Let padding define height */
        }

        .navbar .btn-outline-light:hover {
            background-color: var(--navbar-hover-color);
            color: var(--navbar-bg-start);
            border-color: var(--navbar-hover-color);
        }

        /* Main Content Area */
        .main-content-area {
            background-color: rgba(255, 255, 255, 0.98); 
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); 
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        /* Footer Styling */
        .footer {
            background: linear-gradient(to left, #FF8C00, #FFA500); 
            color: #FAF9F6; 
            padding: 3rem 0;
            border-top: 2px solid #FFBF00;
        }

        .footer h5 {
            color: #FAF9F6;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .footer p, .footer li {
            color: #FAF9F6;
            font-size: 0.95rem;
        }

        .footer a {
            color: #FAF9F6;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer a:hover {
            color: #2E8B57; 
        }

        .social-icons a {
            color: #FAF9F6;
            font-size: 1.5rem;
            margin-right: 15px;
            transition: color 0.3s ease, transform 0.2s ease;
        }

        .social-icons a:hover {
            color: #2E8B57; 
            transform: scale(1.1);
        }

        /* General Button Styling (overriding Bootstrap for theme) */
        .btn-primary {
            background-color: #FF8C00; 
            border-color: #FF8C00;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-primary:hover {
            background-color: #FFA500; 
            border-color: #FFA500;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-success {
            background-color: #2E8B57; 
            border-color: #2E8B57;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-success:hover {
            background-color: #3CB371; 
            border-color: #3CB371;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-info {
            background-color: #17a2b8; 
            border-color: #17a2b8;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-info:hover {
            background-color: #138496;
            border-color: #138496;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-secondary {
            background-color: #6c757d; 
            border-color: #6c757d;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover {
            background-color: #5a6268;
            border-color: #545b62;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* Card Styling */
        .card {
            border: none; 
            border-radius: 1rem; 
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08); 
            overflow: hidden; 
        }

        .card-header {
            background-color: #F0F0F0; 
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            color: #333333;
        }

        /* Form Controls */
        .form-control, .form-select {
            border-radius: 0.5rem;
            border: 1px solid #ced4da;
            padding: 0.75rem 1rem;
        }

        .form-control:focus, .form-select:focus {
            border-color: #FF8C00; 
            box-shadow: 0 0 0 0.25rem rgba(255, 140, 0, 0.25);
        }

        /* Specific elements from all_products.html that might need styling */
        .product-grid {
            /* Styles already defined in all_products.html extra_css_from_page block */
        }

        .product-card {
            /* Styles already defined in all_products.html extra_css_from_page block */
        }

        .product-card .rating {
            color: #FFBF00; 
        }

        .product-card .final-price {
            color: #FF4500; 
        }

        /* Admin Dashboard Cards */
        .card.bg-primary { background-color: #FF8C00 !important; } 
        .card.bg-success { background-color: #2E8B57 !important; } 
        .card.bg-info { background-color: #17a2b8 !important; }
        .card.bg-warning { background-color: #FFBF00 !important; color: #333 !important; } 

        /* Responsive Adjustments */
        @media (max-width: 991.98px) {
            .navbar-nav {
                text-align: center;
                margin-top: 1rem;
                width: 100%; /* Ensure they take full width */
            }
            .navbar-nav .nav-item {
                margin-bottom: 0.5rem;
            }
            .navbar-nav .nav-item .btn-primary {
                width: 80%;
                margin: 0.5rem auto;
            }
            /* Adjust search form for small screens */
            .navbar form.d-flex {
                flex-direction: column;
                align-items: center;
                width: 100%;
                margin-top: 1rem;
                margin-bottom: 1rem; /* Added bottom margin for spacing */
            }
            .navbar form.d-flex .form-control {
                width: 90%;
                margin-bottom: 0.5rem;
            }
            .navbar form.d-flex .btn-outline-light {
                width: 90%;
            }
            /* Ensure the collapse is correctly managed for the hamburger menu */
            .navbar-collapse {
                flex-grow: 1; /* Allow it to take up space when expanded */
                padding-left: 1rem; /* Add padding to the collapsed menu content */
                padding-right: 1rem;
            }
        }
        /* New Styles for larger screens to align search and buttons */
        @media (min-width: 992px) {
            /* The .navbar-collapse should handle the main distribution */
            .navbar-collapse {
                display: flex !important; /* Ensure it's flex on large screens */
                flex-grow: 1; 
                justify-content: flex-end; /* Pushes content to the right */
                align-items: center; 
                width: auto; 
            }
            /* The me-auto and ms-auto classes in HTML now handle alignment, no custom margin here */
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body class="flex flex-col min-h-screen">
    <nav id="mainNavbar" class="navbar fixed-top w-full z-50 navbar-expand-lg"> 
        <div class="container-fluid px-4 md:px-8 lg:px-12 flex items-center justify-between"> <a class="navbar-brand flex items-center" href="{{ url_for('index') }}"> 
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Karthika Futures Logo" style="height: 40px; margin-right: 10px;">
                <span>Karthika Futures</span>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav"> 
                <ul class="navbar-nav me-auto mb-2 mb-lg-0"> 
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('all_products') }}">Products</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('contact') }}">Contact</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('about') }}">About</a>
                    </li>
                </ul>

             {# Search Form - Adjusted for better mobile centering #}
{# On large screens (lg), it will be ms-auto (margin-left auto) to push right #}
{# On smaller screens, d-flex and justify-content-center will center it #}
                <form class="d-flex ms-auto me-2 my-2 my-lg-0 flex-grow-1 justify-content-center"
      action="{{ url_for('all_products') }}" method="GET"> {# ADDED action and method #}
    <input class="form-control me-2" type="search" placeholder="Search by name, SKU, or description..." aria-label="Search" name="search"> {# ADDED name="search" #}
    <button class="btn btn-outline-light" type="submit">Search</button>
</form>



                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link cart-icon-container" href="{{ url_for('cart') }}">
                            <i class="fas fa-shopping-cart"></i> Cart
                            <span class="badge rounded-pill" id="cart-count">0</span>
                        </a>
                    </li>
                    {% if current_user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-user-circle me-1"></i> {{ current_user.full_name or current_user.email }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                <li><a class="dropdown-item" href="{{ url_for('user_profile') }}">My Profile</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('user_orders') }}">My Orders</a></li>
                                {% if current_user.is_admin() %}
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin_dashboard') }}">Admin Dashboard</a></li>
                                {% endif %}
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('logout') }}">Logout</a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link btn btn-primary px-4 py-2 rounded-md" href="{{ url_for('user_login') }}">Login</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn btn-primary px-4 py-2 rounded-md" href="{{ url_for('signup') }}">Sign Up</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    <main class="flex-grow">
        {% block content %}{% endblock %}
    </main>

    <footer class="footer">
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h5 class="text-xl mb-3">Karthika Futures</h5>
                    <p class="text-sm">Your destination for divine artworks and spiritual treasures. We are committed to bringing you high-quality products that inspire and uplift.</p>
                </div>
                <div>
                    <h5 class="text-xl mb-3">Quick Links</h5>
                    <ul class="space-y-2">
                        <li><a href="{{ url_for('index') }}" class="text-sm hover:underline">Home</a></li>
                        <li><a href="{{ url_for('all_products') }}" class="text-sm hover:underline">Products</a></li>
                        <li><a href="{{ url_for('user_orders') }}" class="text-sm hover:underline">My Orders</a></li>
                        <li><a href="{{ url_for('contact') }}" class="text-sm hover:underline">Contact Us</a></li>
                        <li><a href="{{ url_for('user_login') }}" class="text-sm hover:underline">Login</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="text-xl mb-3">Contact Us</h5>
                    <p class="text-sm">
                        Annapurna Apartment, New Alipore<br>
                        West Bengal, 700053, India<br>
                        Email: smarasada@gmail.com<br>
                        Phone: +91 9330480697
                    </p>
                    <div class="social-icons mt-4">
                        <a href="#" class="mr-3"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="mr-3"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="mr-3"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="mr-3"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            <div class="text-center border-t border-gray-700 pt-6 mt-8">
                <p class="text-sm">&copy; {{ now.year }} Karthika Futures. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <script>
        console.log("_base.html: Setting global JS variables.");
        window.csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
        window.isUserLoggedIn = {{ 'true' if current_user.is_authenticated else 'false' }};
        window.userLoginUrl = "{{ url_for('user_login') }}"; // Expose login URL for redirection

        // Scroll navbar hide/show
        let lastScrollTop = 0;
        const navbar = document.getElementById('mainNavbar');
        window.addEventListener('scroll', () => {
            const currentScroll = window.scrollY;
            // Hide navbar when scrolling down, show when scrolling up or at top
            navbar.style.top = (currentScroll > lastScrollTop && currentScroll > 100) ? '-80px' : '0';
            lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
        });
    </script>
    <script src="{{ url_for('static', filename='js/main.js', v=now().timestamp()) }}"></script>
    
    
    <script>
        console.log("_base.html: DOMContentLoaded fired. Initializing flashed messages and cart count.");
        // Custom alert function (replicated from main.js for immediate availability if needed)
        // This is a fallback and main.js's version is preferred.
        function showCustomAlert(message, type = 'info') {
            const container = document.getElementById('flash-messages-container') || document.body;
            const alertDiv = document.createElement('div');
            alertDiv.className = `custom-alert alert-${type}`;
            alertDiv.style.zIndex = 9999;
            alertDiv.innerHTML = `
                <span class="custom-alert-message">${message}</span>
                <button class="ml-4 text-lg font-bold" onclick="this.parentElement.remove()">&times;</button>
            `;
            container.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000); // Remove after 5 seconds
        }

        // Display flashed messages from Flask
        document.addEventListener('DOMContentLoaded', function() {
            const flashedMessages = JSON.parse('{{ get_flashed_messages(with_categories=true) | tojson | safe }}');
            flashedMessages.forEach(function(message) {
                showCustomAlert(message[1], message[0]);
            });

            // Initial fetch of cart count when the page loads
            // This will now rely on main.js's updateCartCountDisplay
            // Use a small delay to ensure main.js has definitely loaded and defined updateCartCountDisplay
            setTimeout(() => {
                if (typeof window.updateCartCountDisplay === 'function') {
                    window.updateCartCountDisplay();
                } else {
                    console.warn("_base.html: window.updateCartCountDisplay not found after delay. Fallback to direct fetch.");
                    fetch('/get_cart_count')
                        .then(response => response.json())
                        .then(data => {
                            const cartCountElement = document.getElementById('cart-count');
                            if (cartCountElement) {
                                cartCountElement.textContent = data.cart_count;
                                cartCountElement.style.display = data.cart_count > 0 ? 'inline-block' : 'none';
                            }
                        })
                        .catch(error => console.error('Error fetching cart count in _base.html fallback:', error));
                }
            }, 200); // Give main.js a bit more time
        });
    </script>

    <script>
    window.updateCartCountDisplay = function () {
        const cartCount = localStorage.getItem('cartCount');
        const cartCountElement = document.getElementById('cart-count');
        if (!cartCountElement) return;

        if (cartCount && parseInt(cartCount) > 0) {
            cartCountElement.textContent = cartCount;
            cartCountElement.style.display = 'inline-block';
        } else {
            cartCountElement.textContent = '';
            cartCountElement.style.display = 'none';
        }
    };
</script>


    {% block extra_js %}{% endblock %}

  
    <!-- Global Loading Placeholder -->
<div id="loading-placeholder" style="display: none;">
    <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-[9999]">
        <div class="text-center text-white text-xl font-semibold animate-pulse">
            ‚è≥ Uploading... Please wait<br>
            üôè Do not close or refresh the page
        </div>
    </div>
</div>

</body>
</html>