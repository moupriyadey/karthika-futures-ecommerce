{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto p-4 bg-white bg-opacity-90 rounded-lg shadow-lg">
    <h2 class="text-4xl font-bold text-gray-800 mb-6 text-center">Search Results</h2>

    {% if query %}
        <p class="text-lg text-gray-700 mb-6 text-center">
            Showing results for: "<span class="font-semibold">{{ query }}</span>" ({{ results | length }} found)
        </p>
    {% else %}
        <p class="text-lg text-gray-700 mb-6 text-center">
            Please enter a search term to find artworks.
        </p>
    {% endif %}

    {% if results %}
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {% for artwork in results %}
            <div class="bg-white rounded-xl shadow-md overflow-hidden transform transition-transform duration-300 hover:scale-105 hover:shadow-xl item-card">
                <a href="{{ url_for('product_detail', sku=artwork.sku) }}">
                    <img src="{{ url_for('static', filename=artwork.images[0]) if artwork.images else 'https://placehold.co/240x240/cccccc/333333?text=No+Image' }}" 
                         alt="{{ artwork.name }}" 
                         class="w-full h-48 object-cover">
                    <div class="p-4 flex flex-col justify-between" style="min-height: 120px;">
                        <div>
                            <h4 class="text-lg font-bold text-gray-900 mb-1 leading-tight">{{ artwork.name }}</h4>
                            <p class="text-sm text-gray-600 mb-2 truncate">{{ artwork.description }}</p>
                        </div>
                        <div>
                            <p class="text-xl font-bold text-blue-600">₹{{ artwork.original_price | int }}</p>
                            <span class="text-sm text-gray-500 line-through">MRP: ₹{{ (artwork.original_price * 1.5) | int }}</span>
                            <span class="text-sm text-green-600 font-semibold ml-2">({{ ((artwork.original_price * 1.5 - artwork.original_price) / (artwork.original_price * 1.5) * 100) | round | int }}% off)</span>
                            <p class="text-sm text-gray-700 mt-1">Stock: {{ artwork.stock }}</p>
                        </div>
                    </div>
                </a>
                <div class="p-4 pt-0">
                    {% if artwork.stock > 0 %}
                    <button class="add-to-cart-btn w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 text-sm"
                            data-sku="{{ artwork.sku }}"
                            data-name="{{ artwork.name }}"
                            data-image="{{ url_for('static', filename=artwork.images[0]) if artwork.images else 'https://placehold.co/240x240/cccccc/333333?text=No+Image' }}"
                            data-original-price="{{ artwork.original_price }}"
                            data-size="Original"
                            data-frame="None"
                            data-glass="None"
                            data-size-price="0"
                            data-frame-price="0"
                            data-glass-price="0">
                        Add to Cart
                    </button>
                    {% else %}
                    <button class="w-full bg-gray-400 text-white font-bold py-2 px-4 rounded-full cursor-not-allowed text-sm" disabled>
                        Out of Stock
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-center text-gray-600 text-lg">No artworks matched your search. Please try a different query.</p>
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Add to Cart button functionality (copied from index.html for consistency)
        document.querySelectorAll('.add-to-cart-btn').forEach(button => {
            button.addEventListener('click', function() {
                const sku = this.dataset.sku;
                const name = this.dataset.name;
                const image = this.dataset.image;
                const originalPrice = parseFloat(this.dataset.originalPrice);
                const options = {
                    size: this.dataset.size,
                    frame: this.dataset.frame,
                    glass: this.dataset.glass,
                    sizePrice: parseFloat(this.dataset.sizePrice || 0),
                    framePrice: parseFloat(this.dataset.framePrice || 0),
                    glassPrice: parseFloat(this.dataset.glassPrice || 0)
                };
                addToCart(sku, name, image, originalPrice, options);
            });
        });
    });
</script>
{% endblock %}
