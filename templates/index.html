{% extends '_base.html' %}

{% block title %}Karthika Futures - Your Gateway to Divine Art{% endblock %}

{% block content %}
<main class="pt-20">

<section class="py-6 bg-gradient-to-r from-purple-600 to-pink-500">
  <div class="container mx-auto px-4 relative">
    <h2 class="text-2xl font-bold text-white mb-4">Explore Categories</h2>

    <div class="swiper mySwiperCategories">
      <div class="swiper-wrapper">
        {% for category in categories %}
        <div class="swiper-slide flex justify-center">
          <a href="{{ url_for('category_page', category_slug=category.name|slugify) }}"
             class="flex flex-col items-center text-center group relative category-link">
            <div class="w-32 h-32 mx-auto rounded-full bg-white shadow-lg overflow-hidden 
                        transform transition duration-300 group-hover:scale-110 flex items-center justify-center">
              
                          <img src="{{ url_for('static', filename=category.image) if category.image else url_for('static', filename='images/placeholder.png') }}"
                       alt="{{ category.name }}"
                       class="w-full h-full object-cover object-center">
            </div>

            <h3 class="mt-4 text-white text-lg font-semibold group-hover:text-amber-300 transition-colors duration-300">
              {{ category.name }}
            </h3>
            
            <div class="category-spinner hidden"></div>
          </a>
        </div>
        {% endfor %}
      </div>

      
    </div>
  </div>
</section>


<style>
  html {
    scroll-behavior: smooth;
  }
</style>

{% for category, products in categorized_artworks.items() %}
<section id="{{ category|lower|replace(' ', '-') }}" class="py-8 mb-8 bg-white rounded-lg shadow-md">
  <div class="container mx-auto px-4">
    <a href="{{ url_for('category_page', category_slug=category|slugify) }}" class="block text-center mb-6">
  <h2 class="text-3xl font-bold gradient-link">
    {{ category|upper }}
  </h2>
</a>

    <div class="swiper mySwiper-{{ category|lower|replace(' ', '-') }}">
      <div class="swiper-wrapper">
      
        {% for product in products %}

<div class="swiper-slide w-full flex justify-center">
    <div class="product-card bg-white rounded-lg shadow-md overflow-hidden transform transition-transform duration-300 hover:scale-105 hover:shadow-xl flex flex-col relative">
        <a href="{{ url_for('product_detail', sku=product.sku) }}">
            <div class="h-48 w-full p-2 flex items-center justify-center">
                <img src="{{ product.get_images_list()[0] if product.get_images_list() else url_for('static', filename='images/placeholder.png') }}" 
                     alt="{{ product.name }}" 
                     class="object-contain max-h-full max-w-full transition-transform duration-300 hover:scale-105">
            </div>
        </a>
        <div class="p-2 flex flex-col justify-between text-center">
            <div>
                <h3 class="text-sm font-semibold text-gray-900 mb-1 truncate">{{ product.name }}</h3>
                <div class="flex items-baseline justify-center mb-1">
                    <span class="text-base font-bold text-primary">{{ product.selling_price_incl_gst | currency }}</span>
                </div>
                <div class="flex items-center justify-center mb-1">
                    <div class="text-yellow-500 text-xs">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i>
                        <i class="fas fa-star"></i><i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                    </div>
                    <span class="text-xs text-gray-600 ml-1">(4.5/5)</span>
                </div>
                {% if product.shipping_charge == 0 %}
                <p class="text-green-600 font-semibold text-xs mb-1">
                    <i class="fas fa-truck mr-1"></i> Free Delivery
                </p>
                {% else %}
                <p class="text-gray-500 font-semibold text-xs mb-1">
                    <i class="fas fa-truck mr-1"></i> Shipping: {{ product.shipping_charge | currency }}
                </p>
                {% endif %}
            </div>
            <div class="flex justify-center mt-2">
                {% if product.stock > 0 %}
                <a href="{{ url_for('product_detail', sku=product.sku) }}" class="btn btn-primary px-3 py-1 text-center text-xs w-full">
                    View Details
                </a>
                {% else %}
                <button class="btn btn-secondary px-3 py-1 opacity-60 cursor-not-allowed text-xs w-full" disabled>
                    Out of Stock
                </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endfor %}


      </div> 

    </div>
  </div>
    </div>
</section>
{% endfor %}

<section class="fade-section py-6 bg-white rounded-lg shadow-md mb-8">
  <div class="container mx-auto px-4">
    <h2 class="fade-item text-4xl sm:text-5xl font-extrabold text-primary mb-12 text-center drop-shadow-lg">
      Most Searched Items
    </h2>
    <div class="swiper mySwiperFeatured">
      <div class="swiper-wrapper">
        {% for artwork in featured_artworks %}
        <div class="swiper-slide w-full flex justify-center">
          <div class="fade-item product-card bg-white rounded-lg shadow-md overflow-hidden transform transition-transform duration-300 hover:scale-105 hover:shadow-xl flex flex-col relative">
            <a href="{{ url_for('product_detail', sku=artwork.sku) }}">
              <div class="h-48 w-full p-2 flex items-center justify-center">
                <img src="{{ artwork.get_images_list()[0] if artwork.get_images_list() else url_for('static', filename='images/placeholder.png') }}"
                     alt="{{ artwork.name }}"
                     class="object-contain max-h-full max-w-full transition-transform duration-300 hover:scale-105">
              </div>
            </a>
            <div class="p-2 flex flex-col justify-between text-center">
              <div>
                <h3 class="text-sm font-semibold text-gray-900 mb-1 truncate">{{ artwork.name }}</h3>
                <div class="flex items-baseline justify-center mb-1">
                  <span class="text-base font-bold text-primary">{{ artwork.selling_price_incl_gst | currency }}</span>
                </div>
                <div class="flex items-center justify-center mb-1">
                  <div class="text-yellow-500 text-xs">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i>
                    <i class="fas fa-star"></i><i class="fas fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                  </div>
                  <span class="text-xs text-gray-600 ml-1">(4.5/5)</span>
                </div>
                {% if artwork.shipping_charge == 0 %}
                <p class="text-green-600 font-semibold text-xs mb-1">
                  <i class="fas fa-truck mr-1"></i> Free Delivery
                </p>
                {% else %}
                <p class="text-gray-500 font-semibold text-xs mb-1">
                  <i class="fas fa-truck mr-1"></i> Shipping: {{ artwork.shipping_charge | currency }}
                </p>
                {% endif %}
              </div>
              <div class="flex justify-center mt-2">
                {% if artwork.stock > 0 %}
                <a href="{{ url_for('product_detail', sku=artwork.sku) }}" class="btn btn-primary px-3 py-1 text-center text-xs w-full">
                  View Details
                </a>
                
                {% else %}
                <button class="btn btn-secondary px-3 py-1 opacity-60 cursor-not-allowed text-xs w-full" disabled>
                  Out of Stock
                </button>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% else %}
        <div class="swiper-slide w-full flex justify-center">
          <p class="text-center text-gray-800 w-full py-10">No featured artworks available at the moment.</p>
        </div>
        {% endfor %}
      </div>

      
    </div>
  </div>
</section>  







    
    <section class="fade-section py-16 bg-primary text-white text-center">
        <div class="container mx-auto">
            <h2 class="fade-item text-4xl font-extrabold mb-6">Discover Your Spiritual Connection</h2>
            <p class="fade-item text-lg md:text-xl max-w-3xl mx-auto mb-8">
                Each artwork at Karthika Futures is a gateway to ancient wisdom and inner peace. Find the piece that resonates with your soul.
            </p>
            <a href="{{ url_for('all_products') }}" class="fade-item btn bg-white text-primary text-xl px-8 py-4 rounded-full shadow-lg hover:bg-gray-100 transform hover:scale-105 transition-all duration-300">
                Begin Your Journey <i class="fas fa-leaf ml-2"></i>
            </a>
        </div>
    </section>

    <section class="fade-section py-16 bg-gradient-to-br from-yellow-50 to-orange-50 text-gray-800">
    <div class="container mx-auto text-center">
        <h2 class="fade-item text-4xl font-extrabold mb-6 text-primary">Mission of Karthikafutures</h2>

            <p class="fade-item text-lg md:text-xl max-w-3xl mx-auto mb-8 leading-relaxed">
                Every purchase from Karthika Futures contributes to the propagation of Dharma and ancient spiritual wisdom.
            </p>
            <a href="{{ url_for('about') }}" class="fade-item btn btn-success text-xl px-8 py-4 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
    Read more about Dharma Prachar <i class="fas fa-heart ml-2"></i>
</a>
        </div>
    </section>

    <section class="fade-section py-16 bg-gradient-to-br from-orange-50 to-yellow-100 text-gray-800">
    <div class="container mx-auto text-center">
        
        <a href="{{ url_for('contact') }}" class="fade-item btn btn-primary text-xl px-8 py-4 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
            Contact for Bulk Orders <i class="fas fa-hand-holding-heart ml-2"></i>
        </a>
    </div>
</section>



    <section class="fade-section py-16 bg-gradient-to-br from-yellow-50 to-orange-100 text-gray-800">
        <div class="container mx-auto text-center">
            <h2 class="fade-item text-4xl font-extrabold mb-10 text-primary">Voices of Devotion</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for testimonial in testimonials %}
                <div class="fade-item bg-white p-6 rounded-lg shadow-lg flex flex-col items-center text-center transform transition-transform duration-300 hover:scale-[1.02] hover:shadow-xl">
                    <img src="{{ url_for('static', filename=testimonial.image) }}" alt="{{ testimonial.name }}" class="w-24 h-24 rounded-full object-cover mb-4 border-4 border-primary shadow-md">
                    <p class="text-lg font-medium mb-3">"{{ testimonial.feedback }}"</p>
                    <div class="text-yellow-500 mb-2">
                        {% for i in range(testimonial.rating) %}<i class="fas fa-star"></i>{% endfor %}
                        {% if testimonial.rating % 1 != 0 %}<i class="fas fa-star-half-alt"></i>{% endif %}
                    </div>
                    <p class="font-semibold text-gray-700">- {{ testimonial.name }}</p>
                    {% if testimonial.product_sku %}
                    <a href="{{ url_for('product_detail', sku=testimonial.product_sku) }}" class="text-sm text-blue-600 hover:underline mt-2">View Artwork</a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

<div class="container my-4 text-center">
  <a href="https://www.youtube.com/@KarthikaStories" target="_blank" 
     class="text-lg sm:text-xl font-semibold text-blue-600 hover:underline">
    <i class="fab fa-youtube text-red-600 mr-2"></i>
    @karthikastories — Watch sacred stories on our channel
  </a>
</div>

    <div id="fullImageView" class="fixed inset-0 bg-black bg-opacity-80 hidden z-50 flex items-center justify-center">
    <div class="relative max-w-3xl w-full" onclick="closeFullImage(event)">
        <img id="fullImage" class="w-full max-h-screen object-contain relative">
        <div class="absolute inset-0 pointer-events-none z-20 flex flex-wrap justify-center items-center text-white text-lg font-bold opacity-40">
            {% for i in range(12) %}<div class="m-4 -rotate-45">Karthikafutures</div>{% endfor %}
        </div>
        <button onclick="closeFullImage(event)" class="absolute top-4 right-4 text-white text-2xl">&times;</button>
    </div>
</div>

</main>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
    function hideAllSpinners() {
        const spinners = document.querySelectorAll('.category-spinner');
        spinners.forEach(spinner => {
            spinner.classList.add('hidden');
        });
    }

    document.addEventListener("DOMContentLoaded", function () {
        hideAllSpinners(); // Hide spinners on initial page load

        const fadeSections = document.querySelectorAll(".fade-section");

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    const fadeItems = entry.target.querySelectorAll(".fade-item");
                    fadeItems.forEach((item, index) => {
                        setTimeout(() => {
                            item.classList.add("fade-visible");
                        }, index * 150); // stagger delay
                    });
                } else {
                    const fadeItems = entry.target.querySelectorAll(".fade-item");
                    fadeItems.forEach((item) => {
                        item.classList.remove("fade-visible");
                    });
                }
            });
        }, { threshold: 0.15 });

        fadeSections.forEach((section) => {
            observer.observe(section);
        });
    });

    // Handle the "pageshow" event for bfcache
    window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
            // Page was restored from the bfcache
            hideAllSpinners();
        }
    });

    function openFullImage(imageUrl) {
        const popup = document.getElementById("fullImageView");
        const popupImage = document.getElementById("fullImage");
        popupImage.src = imageUrl;
        popup.classList.remove("hidden");
        document.body.style.overflow = 'hidden';
    }

    function closeFullImage(event) {
        if (event) {
            event.stopPropagation();
        }
        document.getElementById("fullImageView").classList.add("hidden");
        document.body.style.overflow = 'auto';
    }

    // Initialize the Categories Carousel with Coverflow effect
    // Initialize the Categories Carousel
    const swiperCategories = new Swiper(".mySwiperCategories", {
        slidesPerView: 1,
        spaceBetween: 20,
        loop: true,
        autoplay: {
            delay: 2300,
            disableOnInteraction: false,
        },
        breakpoints: {
            640: {
                slidesPerView: 2,
                spaceBetween: 20,
            },
            768: {
                slidesPerView: 3,
                spaceBetween: 30,
            },
            1024: {
                slidesPerView: 4,
                spaceBetween: 40,
            },
        },
    });


    // Initialize Swiper for each product category section
    const categoryCarousels = document.querySelectorAll("[class*='mySwiper-']");
    categoryCarousels.forEach(carousel => {
        const swiperInstance = new Swiper(carousel, {
            effect: "coverflow",
            grabCursor: true,
            centeredSlides: true,
            loop: true,
            slidesPerView: "auto",
            
            coverflowEffect: {
                rotate: 0,
                stretch: 80,
                depth: 200,
                modifier: 1,
                slideShadows: false,
            },
            
            autoplay: {
                delay: 3000,
                disableOnInteraction: false,
            },
            speed: 1000,
            
            pagination: false,
           
            
            breakpoints: {
                0: {
                    slidesPerView: 1.5,
                    coverflowEffect: {
                        stretch: 40,
                        depth: 100,
                    }
                },
                768: {
                    slidesPerView: 2.5,
                    coverflowEffect: {
                        stretch: 60,
                        depth: 150,
                    }
                },
                1024: {
                    slidesPerView: 3,
                    coverflowEffect: {
                        stretch: 80,
                        depth: 200,
                    }
                },
            },
        });
    });

   var swiperFeatured = new Swiper(".mySwiperFeatured", {
    effect: "coverflow",
    grabCursor: true,
    centeredSlides: true,
    loop: true,
    slidesPerView: "auto",
    
    coverflowEffect: {
        rotate: 0,
        stretch: 80,
        depth: 200,
        modifier: 1,
        slideShadows: false,
    },
    
    autoplay: {
        delay: 3000,
        disableOnInteraction: false,
    },
    speed: 1000,

    
    
    breakpoints: {
        0: {
            slidesPerView: 1.5,
            coverflowEffect: {
                stretch: 40,
                depth: 100,
            }
        },
        768: {
            slidesPerView: 2.5,
            coverflowEffect: {
                stretch: 60,
                depth: 150,
            }
        },
        1024: {
            slidesPerView: 3,
            coverflowEffect: {
                stretch: 80,
                depth: 200,
            }
        },
    },
});
</script>
<style>
    /* Add this to your style.css if the issue persists 
.swiper-slide {
    width: auto !important;   
}
     .......*/


/* Gradient text */
.gradient-link {
  background: linear-gradient(to right, #6f33fa, #fa8e29); /* violet → blue */
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  position: relative;
  display: inline-block;
  cursor: pointer;
  text-decoration: none;
}

/* Blinking blue underline */
.gradient-link::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: -4px; /* space between text and underline */
  width: 100%;
  height: 2px;
  background-color: #3b82f6; /* Tailwind blue-600 */
  animation: blink-underline 1.2s infinite;
}

@keyframes blink-underline {
  0%, 50%, 100% {
    opacity: 1;
  }
  25%, 75% {
    opacity: 0;
  }
}

    /* Spinner for Category Images */
.category-link {
    position: relative;
}

.category-spinner {
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #FFD700; /* Gold color */
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
}

@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Ensure the link container is positioned */
.category-link {
    position: relative;
}
    .watermark-overlay {
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="100"><text x="100" y="50" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="rgba(0, 0, 0, 0.1)" text-anchor="middle" transform="rotate(-45 100 50)">karthikafutures</text></svg>');
        background-repeat: repeat;
        background-size: 200px 100px;
        z-index: 10;
    }

    .bg-within {
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        border-radius: 1rem;
        overflow: hidden;
    }

    .fade-section {
        opacity: 1;
    }

    .fade-item {
        opacity: 0;
        transform: translateY(25px);
        transition: opacity 0.9s ease, transform 0.9s ease;
    }

    .fade-item.fade-visible {
        opacity: 1;
        transform: translateY(0);
    }

    
    .temple-bg {
        background-image: url('{{ url_for('static', filename='images/temple_bg.png') }}');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 0.2;
    }

    @media (max-width: 640px) {
        .temple-bg {
            background-size: contain;
            background-position: top center;
        }
    }
</style>
{% endblock %}