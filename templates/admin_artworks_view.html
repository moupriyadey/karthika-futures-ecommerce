{% extends '_base.html' %}

{% block title %}Manage Artworks - Admin - Karthika Futures{% endblock %}

{% block content %}
<div class="container main-content-area position-relative pt-5">
    <h2 class="text-center mb-4 text-primary font-bold">Manage Artworks</h2>

    {# Admin Navigation Tabs #}
    <ul class="nav nav-tabs nav-justified mb-4">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('admin_panel') }}">Dashboard</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="{{ url_for('admin_artworks_view') }}">Artworks</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('admin_orders_view') }}">Orders</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('admin_categories_view') }}">Categories</a>
        </li>
    </ul>

    <div class="mb-4 d-flex justify-content-end">
        <a href="{{ url_for('add_artwork') }}" class="btn btn-primary shadow-sm rounded-md transition-transform hover:scale-105">
            <i class="fas fa-plus-circle me-2"></i> Add New Artwork
        </a>
    </div>

    {% if artworks %}
    <div class="table-responsive bg-white rounded-lg shadow-lg p-4">
        <table class="table table-hover table-striped mb-0">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
                    <th scope="col" class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SKU & Name</th>
                    <th scope="col" class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                    <th scope="col" class="py-3 px-4 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Original Price</th>
                    <th scope="col" class="py-3 px-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">GST %</th>
                    <th scope="col" class="py-3 px-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                    <th scope="col" class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Options Pricing</th>
                    <th scope="col" class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                    <th scope="col" class="py-3 px-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for artwork in artworks %}
                <tr>
                    <td class="py-3 px-4 align-middle">
                        {% if artwork.images and artwork.images[0] %}
                            <img src="{{ url_for('static', filename=artwork.images[0]) }}" alt="{{ artwork.name }}" class="img-thumbnail rounded" style="width: 80px; height: 80px; object-fit: cover;">
                        {% else %}
                            <img src="{{ url_for('static', filename='images/placeholder.png') }}" alt="No Image" class="img-thumbnail rounded" style="width: 80px; height: 80px; object-fit: cover;">
                        {% endif %}
                    </td>
                    <td class="py-3 px-4 align-middle text-sm text-gray-900">
                        <strong>{{ artwork.sku }}</strong><br>
                        {{ artwork.name }}
                    </td>
                    <td class="py-3 px-4 align-middle text-sm text-gray-900">
                        {{ artwork.category }}
                    </td>
                    <td class="py-3 px-4 align-middle text-sm text-gray-900 text-right">
                        ₹{{ artwork.original_price | round(2) }}
                    </td>
                    <td class="py-3 px-4 align-middle text-sm text-gray-900 text-center">
                        {{ artwork.gst_percentage | round(2) }}%
                    </td>
                    <td class="py-3 px-4 align-middle text-sm text-gray-900 text-center">
                        {{ artwork.stock }}
                    </td>
                    <td class="py-3 px-4 align-middle text-sm text-gray-900">
                        <small>
                            {% if artwork.size_a4 %}A4: ₹{{ artwork.size_a4 | round(2) }}{% endif %}
                            {% if artwork.size_a5 %}<br>A5: ₹{{ artwork.size_a5 | round(2) }}{% endif %}
                            {% if artwork.size_letter %}<br>Letter: ₹{{ artwork.size_letter | round(2) }}{% endif %}
                            {% if artwork.size_legal %}<br>Legal: ₹{{ artwork.size_legal | round(2) }}{% endif %}
                            {% if artwork.frame_wooden %}<br>Wooden Frame: ₹{{ artwork.frame_wooden | round(2) }}{% endif %}
                            {% if artwork.frame_metal %}<br>Metal Frame: ₹{{ artwork.frame_metal | round(2) }}{% endif %}
                            {% if artwork.frame_pvc %}<br>PVC Frame: ₹{{ artwork.frame_pvc | round(2) }}{% endif %}
                            {% if artwork.glass_price %}<br>Glass: ₹{{ artwork.glass_price | round(2) }}{% endif %}
                        </small>
                    </td>
                    <td class="py-3 px-4 align-middle text-sm text-gray-700 max-w-xs overflow-hidden text-truncate" style="max-width: 200px;">
                        {{ artwork.description | default('No description.') }}
                    </td>
                    <td class="py-3 px-4 align-middle text-center">
                        <div class="d-flex justify-content-center space-x-2">
                            <a href="{{ url_for('edit_artwork', sku=artwork.sku) }}" class="btn btn-sm btn-info me-2" title="Edit Artwork">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button class="btn btn-sm btn-danger delete-artwork-btn" data-sku="{{ artwork.sku }}" title="Delete Artwork">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-center text-gray-600 text-lg py-4">No artworks found.</p>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.delete-artwork-btn').forEach(button => {
            button.addEventListener('click', function() {
                const sku = this.dataset.sku;
                if (confirm(`Are you sure you want to delete artwork with SKU: ${sku}? This action cannot be undone.`)) {
                    window.location.href = `{{ url_for('delete_artwork', sku='PLACEHOLDER') }}`.replace('PLACEHOLDER', sku);
                }
            });
        });
    });
</script>
{% endblock %}
