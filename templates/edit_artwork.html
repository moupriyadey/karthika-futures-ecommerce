{% extends '_base.html' %}

{% block title %}Edit Artwork: {{ artwork.name }} - Karthika Futures{% endblock %}

{% block content %}
<div class="container main-content-area position-relative">
    <h2 class="text-center mb-4">Edit Artwork: {{ artwork.name }}</h2>
    
    <form action="{{ url_for('edit_artwork', sku=artwork.sku) }}" method="POST" enctype="multipart/form-data" class="p-4 border rounded shadow-sm bg-light">
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label for="name" class="form-label">Artwork Name</label>
                <input type="text" class="form-control" id="name" name="name" value="{{ artwork.name }}" required>
            </div>
            <div class="col-md-6">
                <label for="sku" class="form-label">SKU (Unique Identifier)</label>
                <input type="text" class="form-control" id="sku" name="sku" value="{{ artwork.sku }}" readonly disabled>
                <input type="hidden" name="sku" value="{{ artwork.sku }}"> {# Send SKU as hidden for POST #}
            </div>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label for="category" class="form-label">Category</label>
                <select class="form-select" id="category" name="category" required>
                    <option value="">Select a Category</option>
                    {% for cat in categories %}
                    <option value="{{ cat.name }}" {% if artwork.category == cat.name %}selected{% endif %}>{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6">
                <label for="original_price" class="form-label">Original Price (₹)</label>
                <input type="number" class="form-control" id="original_price" name="original_price" step="0.01" min="0" value="{{ artwork.original_price }}" required>
            </div>
        </div>
        
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label for="stock" class="form-label">Stock Quantity</label>
                <input type="number" class="form-control" id="stock" name="stock" min="0" value="{{ artwork.stock }}" required>
            </div>
            <div class="col-md-6">
                <label for="gst_percentage" class="form-label">GST Percentage (%)</label>
                <input type="number" class="form-control" id="gst_percentage" name="gst_percentage" step="0.01" min="0" max="100" value="{{ artwork.gst_percentage | default(default_gst_percentage) }}" required>
            </div>
        </div>

        <div class="mb-4">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" id="description" name="description" rows="4">{{ artwork.description }}</textarea>
        </div>

        <!-- Existing Images Display and Management -->
        <div class="mb-4">
            <h4 class="mb-3">Existing Images</h4>
            {% if artwork.images %}
                <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                    {% for image_url in artwork.images %}
                    <div class="col">
                        <div class="card h-100 shadow-sm position-relative">
                            <img src="{{ url_for('static', filename=image_url) }}" class="card-img-top" alt="Artwork Image" style="height: 120px; object-fit: cover;">
                            <div class="form-check position-absolute top-0 end-0 m-2">
                                <input class="form-check-input" type="checkbox" name="images_to_keep" value="{{ image_url }}" checked id="image-{{ loop.index }}">
                                <label class="form-check-label visually-hidden" for="image-{{ loop.index }}">Keep Image</label>
                            </div>
                            <div class="card-footer text-center bg-transparent border-top-0 pt-1 pb-0">
                                <small class="text-muted">Keep</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="form-text mt-2">Uncheck images you wish to delete.</div>
            {% else %}
                <p class="text-muted">No images currently uploaded for this artwork.</p>
            {% endif %}
        </div>

        <!-- New Images Upload -->
        <div class="mb-4">
            <label for="new_images" class="form-label">Upload New Images (Max 16MB per file)</label>
            <input type="file" class="form-control" id="new_images" name="new_images" accept="image/*" multiple>
            <div class="form-text">Select one or more new image files to add.</div>
        </div>

        <h4 class="mb-3 mt-5">Pricing for Options</h4>
        <p class="text-muted mb-4">Enter additional prices for different sizes, frames, and glass. Enter 0 if not applicable.</p>

        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <label for="frame_wooden" class="form-label">Frame: Wooden Price (₹)</label>
                <input type="number" class="form-control" id="frame_wooden" name="frame_wooden" step="0.01" min="0" value="{{ artwork.frame_wooden | default('0.00') }}">
            </div>
            <div class="col-md-4">
                <label for="frame_metal" class="form-label">Frame: Metal Price (₹)</label>
                <input type="number" class="form-control" id="frame_metal" name="frame_metal" step="0.01" min="0" value="{{ artwork.frame_metal | default('0.00') }}">
            </div>
            <div class="col-md-4">
                <label for="frame_pvc" class="form-label">Frame: PVC Price (₹)</label>
                <input type="number" class="form-control" id="frame_pvc" name="frame_pvc" step="0.01" min="0" value="{{ artwork.frame_pvc | default('0.00') }}">
            </div>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label for="glass_price" class="form-label">Glass Price (₹)</label>
                <input type="number" class="form-control" id="glass_price" name="glass_price" step="0.01" min="0" value="{{ artwork.glass_price | default('0.00') }}">
            </div>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <label for="size_a4" class="form-label">Size: A4 Price (₹)</label>
                <input type="number" class="form-control" id="size_a4" name="size_a4" step="0.01" min="0" value="{{ artwork.size_a4 | default('0.00') }}">
            </div>
            <div class="col-md-3">
                <label for="size_a5" class="form-label">Size: A5 Price (₹)</label>
                <input type="number" class="form-control" id="size_a5" name="size_a5" step="0.01" min="0" value="{{ artwork.size_a5 | default('0.00') }}">
            </div>
            <div class="col-md-3">
                <label for="size_letter" class="form-label">Size: Letter Price (₹)</label>
                <input type="number" class="form-control" id="size_letter" name="size_letter" step="0.01" min="0" value="{{ artwork.size_letter | default('0.00') }}">
            </div>
            <div class="col-md-3">
                <label for="size_legal" class="form-label">Size: Legal Price (₹)</label>
                <input type="number" class="form-control" id="size_legal" name="size_legal" step="0.01" min="0" value="{{ artwork.size_legal | default('0.00') }}">
            </div>
        </div>
        
        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
            <button type="submit" class="btn btn-primary btn-lg">Update Artwork</button>
            <a href="{{ url_for('admin_artworks_view') }}" class="btn btn-secondary btn-lg">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}
